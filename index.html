<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Libre+Baskerville:wght@400;700&family=Oswald:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700;800;900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300&family=Quicksand:wght@300;400;500;600&family=Sofia+Sans:wght@300;400;500;600;700&family=Source+Serif+Pro:wght@300;400;600;700;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
        integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Next Dictionary: know your language!</title>
</head>

<body>
    <nav class="nav">
        <div class="headline">
            <h1>Next</h1>
            <h1>Dictionary</h1>
        </div>
        <div class="searchbar">
            <p class="placeholder">Enter word to search</p><input type="text" name="" id="" class="search"><i
                class="fa-solid fa-magnifying-glass"></i>
        </div>
        <div class="settaccount">
            <div class="darklight"><i class="fa-solid fa-sun"></i></div>
            <div class="account" title="Sign up or log in"><i class="fa-solid fa-user"></i><b>guest</b></div>
        </div>
    </nav>
    <div class="accdetails">
        <div class="userpic"></div>
        <div class="fullname">Guest User</div>
        <div class="handle">@guest</div>
        <div class="gmail">YourEmailHere@gmail.com</div>
        <div class="ph">+1-0000011111</div>
        <button class="logout">Log In</button>
    </div>
    <div class="history" id="histslide">
        <div id="hwrapper">
            <h1>Search history</h1>
        </div>
    </div>
    <div class="bookmarks" id="bookmslide"></div>
    <section class="menu">
        <div class="menuitem active" id="Home"><i class="fa-solid fa-house"></i>Home</div>
        <div class="menuitem" id="history"><i class="fa-solid fa-clock-rotate-left"></i>history</div>
        <div class="menuitem" id="bookmarks"><i class="fa-solid fa-bookmark"></i>bookmarks</div>
        <div class="menuitem" id="trending"><i class="fa-solid fa-fire"></i>Trending</div>
        <div class="menuitem" id="support"><i class="fa-solid fa-headset"></i>support</div>
    </section>
    <section class="scrollable">
        <h1 class="word">Hello</h1>
        <div class="toolbox">
            <div class="copy"><i class="fa-regular fa-copy"></i></div>
            <div class="listen" data-audio-link="" data-error="0"><i class="fa-solid fa-volume-high"></i></div>
            <div class="bookm"><i class="fa-solid fa-bookmark"></i></div>
            <div class="font"><i class="fa-solid fa-font"></i></div>
        </div>
        <div class="poslist">
            <div class="pos">Noun</div>
            <div class="pos">Verb</div>
            <div class="pos">interjection</div>
        </div>
        <div class="posholder">
            <div class="pos1">
                <div class="meaning"></div>
                <div class="example"></div>
            </div>
        </div>
        </div>

    </section>
    <script src="app.js" defer></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-auth.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-storage.js";
        import { getDatabase, ref as dbref, onValue ,push} from "https://www.gstatic.com/firebasejs/9.17.2/firebase-database.js";
        const firebaseConfig = {
            apiKey: "AIzaSyDuinZ2LIH8eXRUFHjdfJEXzm7oVQz7Ous",
            authDomain: "nextdictionary-47e38.firebaseapp.com",
            databaseURL: "https://nextdictionary-47e38-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "nextdictionary-47e38",
            storageBucket: "nextdictionary-47e38.appspot.com",
            messagingSenderId: "74714748153",
            appId: "1:74714748153:web:b0d3c1dfe0fe8d71a57e28"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const storage = getStorage(app);
        const db = getDatabase(app);
        var usern="";
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                document.querySelector(".logout").innerHTML = "Log In";
                document.querySelector(".logout").style.backgroundColor = "rgb(0, 185, 62)";
                document.querySelector(".gmail").innerHTML = "YourEmailHere@gmail.com";
                document.querySelector(".handle").innerHTML = "@guest";
                document.querySelector(".fullname").innerHTML = "Guest User";
                document.querySelector(".ph").innerHTML = "+1-0000011111";
                document.querySelector(".userpic").style.backgroundImage = "url(https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460__340.png)";
                document.querySelector(".account").innerHTML = "<i class='fa-solid fa-user'></i><b>guest</b>";

            }
            else {
                document.querySelector(".logout").innerHTML = "Log Out";
                document.querySelector(".logout").style.backgroundColor = "rgb(185, 0, 0)";
                document.querySelector(".logout").style.color = "white";

                console.log(user);
                onValue(dbref(db, '/accounts/' + user.uid + '/email'), (entry) => {
                    console.log(entry);
                    document.querySelector(".gmail").innerHTML = entry._node.value_;
                });
                onValue(dbref(db, 'accounts/' + user.uid + "/phone"), (entry) => {
                    console.log(entry);
                    document.querySelector(".ph").innerHTML = entry._node.value_;
                });
                onValue(dbref(db, 'accounts/' + user.uid + "/name"), (entry) => {
                    console.log(entry);
                    document.querySelector(".fullname").innerHTML = entry._node.value_;
                });
                document.querySelector(".searchbar i").onclick=()=>{
                    if(document.querySelector(".searchbar input").value!=""){
                        const arrayRef = dbref(db, 'accounts/' + user.uid + "/history");
                        push(arrayRef, document.querySelector(".searchbar input").value)
                    }
                }

                getDownloadURL(ref(storage, user.email))
                    .then((url) => {
                        document.querySelector(".account").innerHTML = "<img src='"+url+"' alt=''>";
                        const img = document.querySelector('.userpic');
                        img.style.backgroundImage = "url(" + url + ")"
                    })
                    .catch((error) => {
                        console.log(error);
                    });
                    onValue(dbref(db, 'accounts/' + user.uid + "/username"), (entry) => {
                    console.log(entry);
                    document.querySelector(".handle").innerHTML = "@" + entry._node.value_;
                    document.querySelector(".account").innerHTML += "<b>"+entry._node.value_+"</b>";
                });
            }
        });
        
                
        document.querySelector(".logout").addEventListener("click", () => {
            if (document.querySelector(".logout").innerHTML === "Log In") {
                location.replace("login.html")
            }
            else {
                signOut(auth)
                    .then(() => {
                        alert("succesfully signed out!")
                    })
                    .catch((error) => {
                        alert(error);
                    })
            }

        })
    </script>
</body>

</html>